@model List<SistemaSolicitudes.Models.Solicitud>
@{
    ViewData["Title"] = "Gestión de Solicitudes";
}

<h2 class="mb-4">Solicitudes Activas</h2>

<!-- Formulario de búsqueda -->
<form asp-action="Index" method="get" class="mb-4">
    <div class="input-group">
        <input type="text" name="folioBusqueda" value="@ViewBag.FolioBusqueda" class="form-control" placeholder="Buscar por folio o nombre del solicitante..." />
        <button class="btn btn-secondary" type="submit">
            <i class="bi bi-search"></i> Buscar
        </button>
        <a asp-action="Create" class="btn btn-primary ms-2">Nueva Solicitud</a>
    </div>
</form>

@if (TempData["Mensaje"] != null)
{
    <div class="alert alert-success">@TempData["Mensaje"]</div>
}

@if (Model.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Folio</th>
                    <th>Solicitante</th>
                    <th>Tipo</th>
                    <th>Departamento</th>
                    <th>Archivos</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Reverse()) <!-- Más reciente arriba -->
                {
                    <tr>
                        <td>@item.ID</td>
                        <td>@item.Folio</td>
                        <td>@(item.NombreSolicitante ?? "—")</td>
                        <td>@(item.TipoSolicitud?.Nombre ?? "—")</td>
                        <td>@(item.Departamento ?? "—")</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.RutaOficio))
                            {
                                <a href="@item.RutaOficio" target="_blank" class="btn btn-sm btn-outline-primary">Oficio</a>
                            }
                            @if (!string.IsNullOrEmpty(item.RutaAnexos))
                            {
                                <a href="@item.RutaAnexos" target="_blank" class="btn btn-sm btn-outline-info">Anexos</a>
                            }
                        </td>
                        <td>
                            <form asp-action="Inactivar" method="post" style="display:inline;">
                                <input type="hidden" name="id" value="@item.ID" />
                                <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('¿Marcar como inactivo? El registro se conservará con su consecutivo.')">
                                    Inactivar
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert alert-warning">
        No hay solicitudes activas @(!string.IsNullOrEmpty(ViewBag.FolioBusqueda) ? $"que coincidan con '{ViewBag.FolioBusqueda}'" : "").
    </div>
}